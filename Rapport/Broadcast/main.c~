#include <sys/time.h>
#include <semaphore.h>
#include <unistd.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <pthread.h>

#define MAX_N_THREADS 1
#define MAX_N_ITERATIONS 10

sem_t sem;
pthread_mutex_t mutex; 
pthread_cond_t broadcast;

int time[MAX_N_THREADS];
int start_time[MAX_N_THREADS];


static void *extra_thread(void *idptr)
{
	int *tmp = (int *) idptr;
	int id = *tmp;
	sem_post(&sem);

	while(1)
		pthread_mutex_lock(&mutex);
		while(start_time[id] == 0){
			pthread_cond_wait(&lift->cond_new_floor,&lift->mutex);
		}
		time[id]=time[id]+start_time[id]-time;
		start_time[id] = 0;
		pthread_mutex_unlock(&mutex);

		


	}

	return NULL;
}


static void *main_thread(void *unused)
{
	pthread_t thread_handle[MAX_N_THREADS];
	int thread_id;

	int iter = 0;


	for(thread_id = 0; thread_id < MAX_N_THREADS; thread_id++){
		pthread_create(&thread_handle[thread_id],NULL, extra_thread,(void *) &thread_id);
		sem_wait(&sem);
	}
	
	while(iter < MAX_N_ITER){
		if(next_iter())
			pthread_mutex_lock(&mutex);
			pthread_cond_broadcast(&broadcast);
			pthread_mutex_unlock(&mutex);
			iter++;
		}
		else{
			fprintf(stderr, "Not all broadcast are done!\n");
		}
		usleep(1000);
	}
	
	int i;
	for(i=0; i < thread_id; i++){
		pthread_join(thread_handle[i], NULL);
	}

	return NULL;
}




int main(int argc, char **argv)
{

	sem_init(&lift->sem, 0, 0);
	pthread_mutex_init(&mutex,NULL);
	pthread_cond_init(&broadcast,NULL); 

	pthread_t main_thread_handle;

	pthread_create(&main_thread_handle, NULL, main_thread, 0);

	pthread_join(main_thread_handle, NULL);

	return 0;
}
